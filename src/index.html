<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR-Code Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <style>
        .rounded-corners {
            border-radius: 10px; /* Abgerundete Ecken */
            overflow: hidden; /* Verhindert, dass der Inhalt über die Ecken hinausgeht */
        }

    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">

    <div class="bg-white p-6 rounded-lg shadow-md w-96">
        <h1 class="text-xl font-bold mb-4 text-center">QR-Code Generator</h1>
        <input id="inputText" type="text" placeholder="Geben Sie Ihren Text ein" class="border rounded-md p-2 w-full mb-4" />
        
        <label class="flex items-center mb-4">
            <input type="checkbox" id="roundedCorners" class="mr-2" checked>
            <span>Abgerundete Ecken</span>
        </label>

        <label class="block mb-2">QR-Code Farbe:</label>
        <input type="color" id="qrColor" value="#000000" class="border rounded-md w-full mb-4" />

        <label class="block mb-2">Hintergrundfarbe:</label>
        <input type="color" id="bgColor" value="#ffffff" class="border rounded-md w-full mb-4" disabled /> <!-- Hintergrundfarbe deaktiviert -->

        <button id="generateBtn" class="bg-blue-500 text-white py-2 rounded-lg w-full hover:bg-blue-600">QR-Code generieren</button>
        
        <div id="qrcode" class="mt-4 rounded-corners"></div>
        
        <button id="downloadBtn" class="bg-green-500 text-white py-2 rounded-lg w-full mt-4 hover:bg-green-600" style="display: none;">QR-Code herunterladen</button>
        
    </div>

    <script>
        function areColorsSimilar(color1, color2) {
            const r1 = parseInt(color1.slice(1, 3), 16);
            const g1 = parseInt(color1.slice(3, 5), 16);
            const b1 = parseInt(color1.slice(5, 7), 16);
            const r2 = parseInt(color2.slice(1, 3), 16);
            const g2 = parseInt(color2.slice(3, 5), 16);
            const b2 = parseInt(color2.slice(5, 7), 16);

            // Berechnung der Differenz zwischen den Farben
            const distance = Math.sqrt(
                Math.pow(r1 - r2, 2) +
                Math.pow(g1 - g2, 2) +
                Math.pow(b1 - b2, 2)
            );

            return distance < 100; // Schwellenwert für ähnliche Farben
        }

        $(document).ready(function() {
            $('#generateBtn').click(function() {
                const text = $('#inputText').val();
                const isRounded = $('#roundedCorners').is(':checked');
                const qrColor = $('#qrColor').val();
                const bgColor = '#ffffff'; // Hintergrundfarbe ist festgelegt und unveränderlich

                $('#qrcode').empty();
                $('#colorWarning').hide(); // Versteckt die Warnung standardmäßig

                // Überprüfen, ob die Farben ähnlich sind
                if (areColorsSimilar(qrColor, bgColor)) {
                    $('#colorWarning').show(); // Zeigt die Warnung an
                } else {
                    $('#colorWarning').hide(); // Versteckt die Warnung, wenn die Farben nicht ähnlich sind
                }

                // Erstellen eines neuen QRCode-Objekts
                const qrcode = new QRCode("qrcode", {
                    text: text,
                    width: 200,
                    height: 200,
                    colorDark: qrColor,
                    colorLight: bgColor,
                    correctLevel: QRCode.CorrectLevel.H
                });

                // Runden Sie die Ecken an, wenn die Checkbox aktiviert ist
                if (isRounded) {
                    $('#qrcode').addClass('rounded-corners');
                } else {
                    $('#qrcode').removeClass('rounded-corners');
                }

                // Anzeigen des Download-Buttons
                $('#downloadBtn').show();
            });

            // Download-Funktion
            $('#downloadBtn').click(function() {
                const canvas = $('#qrcode canvas')[0];
                const roundedCanvas = document.createElement('canvas');
                const context = roundedCanvas.getContext('2d');

                // Setzen der Größe des neuen Canvas
                roundedCanvas.width = canvas.width;
                roundedCanvas.height = canvas.height;

                // Runden Sie die Ecken an
                context.beginPath();
                context.moveTo(10, 0);
                context.lineTo(roundedCanvas.width - 10, 0);
                context.quadraticCurveTo(roundedCanvas.width, 0, roundedCanvas.width, 10);
                context.lineTo(roundedCanvas.width, roundedCanvas.height - 10);
                context.quadraticCurveTo(roundedCanvas.width, roundedCanvas.height, roundedCanvas.width - 10, roundedCanvas.height);
                context.lineTo(10, roundedCanvas.height);
                context.quadraticCurveTo(0, roundedCanvas.height, 0, roundedCanvas.height - 10);
                context.lineTo(0, 10);
                context.quadraticCurveTo(0, 0, 10, 0);
                context.closePath();
                context.clip();

                // Zeichnen Sie den ursprünglichen QR-Code auf das neue Canvas
                context.drawImage(canvas, 0, 0);

                // Download-Link erstellen
                const link = document.createElement('a');
                link.href = roundedCanvas.toDataURL('image/png');
                link.download = 'qrcode.png';
                link.click();
            });
        });
    </script>
</body>
</html>
